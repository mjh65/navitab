# This file is part of the Navitab project. See the README and LICENSE for details.

set(MBEDTLS_AS_SUBPROJECT ON CACHE INTERNAL "")
set(ENABLE_PROGRAMS OFF CACHE INTERNAL "")
set(ENABLE_TESTING OFF CACHE INTERNAL "")
set(MBEDTLS_FATAL_WARNINGS OFF CACHE INTERNAL "")
set(TEST_CPP OFF CACHE INTERNAL "")

add_subdirectory("${mbedtls_SOURCE_DIR}" "${mbedtls_BINARY_DIR}" EXCLUDE_FROM_ALL)

unset(MBEDTLS_AS_SUBPROJECT CACHE)
unset(ENABLE_PROGRAMS CACHE)
unset(ENABLE_TESTING CACHE)
unset(MBEDTLS_FATAL_WARNINGS CACHE)
unset(TEST_CPP CACHE)

# This is to influence findPackage into detecting Navitab's version of MbedTLS
set(MBEDTLS_INCLUDE_DIR "${mbedtls_SOURCE_DIR}/include" CACHE INTERNAL "")
if(MSVC)
    set(MBEDTLS_LIBRARY "${NAVITAB_IMPORT_LIBS}/mbedtls.lib" CACHE INTERNAL "")
    set(MBEDX509_LIBRARY "${NAVITAB_IMPORT_LIBS}/mbedx509.lib" CACHE INTERNAL "")
    set(MBEDCRYPTO_LIBRARY "${NAVITAB_IMPORT_LIBS}/mbedcrypto.lib" CACHE INTERNAL "")
    set(EVEREST_LIBRARY "${NAVITAB_IMPORT_LIBS}/everest.lib" CACHE INTERNAL "")
    set(P256M_LIBRARY "${NAVITAB_IMPORT_LIBS}/p256m.lib" CACHE INTERNAL "")
else()
    set(MBEDTLS_LIBRARY "${NAVITAB_IMPORT_LIBS}/libmbedtls.a" CACHE INTERNAL "")
    set(MBEDX509_LIBRARY "${NAVITAB_IMPORT_LIBS}/libmbedx509.a" CACHE INTERNAL "")
    set(MBEDCRYPTO_LIBRARY "${NAVITAB_IMPORT_LIBS}/libmbedcrypto.a" CACHE INTERNAL "")
    set(EVEREST_LIBRARY "${NAVITAB_IMPORT_LIBS}/libeverest.a" CACHE INTERNAL "")
    set(P256M_LIBRARY "${NAVITAB_IMPORT_LIBS}/libp256m.a" CACHE INTERNAL "")
endif()

# Cache settings to be used when BUILD_NAVITAB_THIRDPARTY is OFF
set(NAVITAB_mbedtls_PKGLIBS mbedtls mbedx509 mbedcrypto everest p256m CACHE INTERNAL "")
set(NAVITAB_mbedtls_LOCATION "${MBEDTLS_LIBRARY}" CACHE INTERNAL "")
set(NAVITAB_mbedtls_LINKLIBS mbedx509 mbedcrypto everest p256m CACHE INTERNAL "")
set(NAVITAB_mbedx509_LOCATION "${MBEDX509_LIBRARY}" CACHE INTERNAL "")
set(NAVITAB_mbedcrypto_LOCATION "${MBEDCRYPTO_LIBRARY}" CACHE INTERNAL "")
set(NAVITAB_everest_LOCATION "${EVEREST_LIBRARY}" CACHE INTERNAL "")
set(NAVITAB_p256m_LOCATION "${P256M_LIBRARY}" CACHE INTERNAL "")
